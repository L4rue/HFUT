# 微机原理课设
汇编，基于8259、8255、8253；

## 设计题目及要求：
### 题目：
### 利用 8259A中断，实现对发光二极管显示的控制。
### 要求：
>1.	以拨动开关S4的动作，模拟事件的发生。通过8259A的IR2引脚以硬件中断方式检测开关动作。
>2.	根据识别到的开关动作次数，从左开始同时点亮对应个数的发光二极管。
>3.	若发生次数为奇数，则让被点亮的发光二极管，以1秒（硬件实现）间隔向右移动，每次移动一个发光二极管。移至最右端后全部熄灭。
>4.	若发生次数为偶数，则让被点亮的发光二极管，以2秒（硬件实现）间隔向右移动，每次移动两个发光二极管。移至最右端后全部熄灭。
>5.	若开关连续动作次数大于6，则所有发光二极管闪烁6次后熄灭，并恢复初始状态。

## 设计思想：
代码参考了几次相关实验的代码，在这些已经做过的实验的基本代码思想上，编写了此次课设的代码。  
  
首先，主程序进行初始化中断芯片（设置地址、写控制字等）、写中断、初始化计数器Counter、初始化显示标志ReDisplayFlag以及开中断等操作对程序进行初始化；然后进入等待阶段，不断循环判断是否有中断产生，若有中断产生则ReDisplayFlag标志会变为1（在中断里）。当ReDisplayFlag变为1后进行一个5s（软件实现）的延迟来等待用户继续拨动开关，并统计拨动次数，随后进入到相应的状态，进行亮灯流程。当所有相应操作结束后，将计数器Counter及标志置零，进入空循环中等待用户的下一次拨动。  
  
其中，主要的子程序有四个部分，分别是：开关中断，右移控制，8253延时设置，及亮灯程序：  
  
对于开关的中断，按照要求，使用8259A芯片的IR2引脚作为中断响应引脚，把单脉冲开关S4与之相连，其他线接入对应CPU引脚。8259A为边沿触发，中断端口号IR0-IR7对应的向量分别为08H-0EH。当对应的端口（也就是0AH）发生中断时，进入中断程序INT_0。在中断中，counter++，redisplayflag=1，并设置控制字。  
对于8253延时程序，硬件部分8253的OUT0口接8255的PC0口，CLK0接1953时钟脉冲，GATE为高电平，其余接到CPU的对应引脚上。子程序为1s延时，用0号计数器用来分频，用方式3将之变为频率较小的方波，输入到计数器1的CLK中。计数器1选用方式0做计数结束中断，输出给PC0，并选1s对应的计数初值。子程序若在输入计数初值后读到PC0变为1，则1S结束，子程序结束。  
  
对于右移控制，判断好counter次数后进行相应程序，在程序内使用ror命令移动一定位数，然后输出使灯亮灭。最后判断最后一位是否为0（即亮），若为0则表示已亮完，返回结束子程序；若不为0则继续ror。  
  
对于亮灯程序，使用8255A的A口连接发光二极管，PC0端口连接8253，用于接收时间信号。其他引脚接到对应引脚上。在初始化时设置好输出端口A。在五秒延迟后，调用判断是否大于6，若大于6则进入闪烁程序段，结束跳出；若小于等于6则进一步判断奇偶，根据奇偶按照不同的要求进行闪烁。亮完返回，继续等待。若在亮的时候又触发了中断则停止当前亮灯，跳到灭标签，结束当前亮灯子程序，回到主程序，中断标识清零，进行下一轮新的亮灯。
